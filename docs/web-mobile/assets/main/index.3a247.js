window.__require=function e(t,i,n){function a(s,c){if(!i[s]){if(!t[s]){var l=s.split("/");if(l=l[l.length-1],!t[l]){var r="function"==typeof __require&&__require;if(!c&&r)return r(l,!0);if(o)return o(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var d=i[s]={exports:{}};t[s][0].call(d.exports,function(e){return a(t[s][1][e]||e)},d,d.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<n.length;s++)a(n[s]);return a}({AudioManager:[function(e,t,i){"use strict";cc._RF.push(t,"5f1e8ds0wBGCIRQBCfFfqcl","AudioManager"),i={instance:null};var n=cc.Class({name:"Sound",properties:{name:"",clips:{type:[cc.AudioClip],default:[]},duration:3}});cc.Class({extends:cc.Component,properties:{sfx:{type:[n],default:[]},masterVolume:{type:cc.Float,default:1},backgroundMusic:{type:cc.AudioClip,default:null},environmentMusic:{type:cc.AudioClip,default:null},voiceOver:{type:cc.AudioClip,default:null},_backgroundMusicId:{default:null},_environmentMusicId:{default:null},_voiceOverId:{default:null},_currentSoundId:{default:null},_audioModules:{default:[]}},isPlaying:function(){},getSoundByName:function(e){return this.sfx.find(function(t){return t.name===e})},playSfx:function(e,t,i){void 0===i&&(i=!1);var n=this.getSoundByName(e).clips;if(0==n.length||null==n)return console.error("No sound found by name or clips list is empty for",e),-1;var a=Math.floor(Math.random()*n.length),o=cc.audioEngine.playEffect(n[a],i);return cc.audioEngine.setFinishCallback(o,function(){if(t)return t()}),o},getSfxDuration:function(e){return this.getSoundByName(e).duration},stopSfx:function(e){cc.audioEngine.stopEffect(e)},stopAllSfx:function(){for(var e=0;e<this._audioModules.length;e++)this._audioModules.pop().stopAll()},toggleSound:function(){0===this.masterVolume?this.masterVolume=1:this.masterVolume=0,cc.audioEngine.setEffectsVolume(this.masterVolume)},playVoiceOver:function(e){var t=this;if(this.voiceOver)this._voiceOverId=cc.audioEngine.playEffect(this.voiceOver,!1),cc.audioEngine.setFinishCallback(this._voiceOverId,function(){if(t.playMusic(),e)return e()});else if(this._voiceOverId=-1,this.playMusic(),e)return e()},playMusic:function(){cc.audioEngine.setEffectsVolume(this.masterVolume),this.backgroundMusic&&(this._backgroundMusicId=cc.audioEngine.playEffect(this.backgroundMusic,!0)),this.environmentMusic&&(this._environmentMusicId=cc.audioEngine.playEffect(this.environmentMusic,!0))},onLoad:function(){i.instance=this}}),t.exports=i,cc._RF.pop()},{}],AudioModule:[function(e,t){"use strict";cc._RF.push(t,"5f2e0+Jy9NPlbbXyxGJL5E1","AudioModule");var i=e("AudioManager");cc.Class({properties:{audioReferences:{default:{}}},__ctor__:function(){this._previousClip=null,this._isPlaying=!1,i.instance._audioModules.push(this)},playSfx:function(e,t,n){var a=this;if(void 0===n&&(n=!1),null!=i.instance.getSoundByName(e)){null!==this.audioReferences[e]&&void 0!==this.audioReferences[e]||(this.audioReferences[e]=[]);var o=i.instance.playSfx(e,function(){t&&t(),delete a.audioReferences[e]},n);this.audioReferences[e].push(o)}},playSfxOnly:function(e,t,n){var a=this;if(void 0===n&&(n=!1),null!=i.instance.getSoundByName(e)){null!==this.audioReferences[e]&&void 0!==this.audioReferences[e]||(this.audioReferences[e]=[]),this._previousClip&&this.audioReferences[this._previousClip]>0&&this.stopSfx(this._previousClip),this._previousClip&&this.stopSfx(this._previousClip),this._previousClip=e;var o=i.instance.playSfx(e,function(){t&&t(),delete a.audioReferences[e]},n);o&&this.audioReferences[e]&&this.audioReferences[e].push(o)}},getSfxDuration:function(e){return i.instance.getSfxDuration(e)},stopSfx:function(e){var t=this.audioReferences[e];if(null!=t){for(var n=0;n<t.length;n++)i.instance.stopSfx(t[n]);delete this.audioReferences[e]}},stopAllSfx:function(){Object.keys(this.audioReferences).forEach(function(e){this.stopSfx(this.audioReferences[e])})}}),cc._RF.pop()},{AudioManager:"AudioManager"}],InputManager:[function(e,t,i){"use strict";cc._RF.push(t,"c9bceL9k59FSqlKi4jjAVs4","InputManager");var n=e("./TileMapManager");cc.Class({extends:cc.Component,properties:{objectLayer:{type:cc.TiledObjectGroup,default:null},camNode:{type:cc.Node,default:null},touchNode:{type:cc.Node,default:null},tiledMapManager:{type:n,default:null},selectedItem:{type:cc.Node,default:null},items:{type:[cc.Node],default:[]}},selectItem:function(e,t){this.selectedItem.active=!1,this.selectedItem=this.items[t],this.selectedItem.active=!0},getLayerWidth:function(){return this.tiledMapManager.tiledLayer.getMapTileSize().width},getLayerHeight:function(){return this.tiledMapManager.tiledLayer.getMapTileSize().height},addInvalidTile:function(e){if(this.tiledMapManager.checkValidPos(e)){var t=this.tiledMapManager.getMappedTile(e);this.tiledMapManager._invalidTiles.push(t)}},removeInvalidTile:function(e){if(this.tiledMapManager.checkValidPos(e)){var t=this.tiledMapManager.getMappedTile(e);if(t)for(var i=0;i<this.tiledMapManager._invalidTiles.length;i++)if(this.tiledMapManager._invalidTiles[i]==t){this.tiledMapManager._invalidTiles.splice(i,1);break}}},onKeyUp:function(){},createObjects:function(e){this.objects=e.getObjects(),this.objects&&this.objects.forEach(function(){})},getValidTiles:function(e){var t=this.selectedItem.getComponent("Item").x,i=this.selectedItem.getComponent("Item").y,n=this.tiledMapManager.tiledLayer.getMapTileSize().width,a=this.tiledMapManager.tiledLayer.getMapTileSize().height,o=[],s=cc.v2(e.x,e.y);if(this.tiledMapManager.checkValidPos(s)&&this.tiledMapManager.checkValidWalkablePos(s)){var c=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,newpos2);(d=this.tiledMapManager.tiledLayer.getTiledTileAt(c.x,c.y,!0)).node,o.push(d)}for(var l=1;l<t;l++)for(var r=1;r<i;r++){var d,u=cc.v2(s.x-l*n,s.y-r*a);if(this.tiledMapManager.checkValidPos(u)&&this.tiledMapManager.checkValidWalkablePos(u))c=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,u),(d=this.tiledMapManager.tiledLayer.getTiledTileAt(c.x,c.y,!0)).node,o.push(d)}return o},checkValidMovePos:function(e){var t=this,i=this.selectedItem.getComponent("Item").x*this.selectedItem.getComponent("Item").y,n=this.getValidTiles(e);if(i==n.length){cc.instantiate(this.selectedItem).parent=this.selectedItem.parent;var a=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,e),o=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(this.tiledMapManager.tiledLayer.getPositionAt(a.x,a.y));this.selectedItem.setPosition(cc.v2(o.x+192,o.y+220)),n.forEach(function(e){t.tiledMapManager._invalidTiles.push(e)})}},HoverEvent:function(e){var t=this;console.log("moving");var n=this.tiledMapManager.node.getComponent(cc.TiledMap),a=(n.getMapSize().height,n.getMapSize().width,e.getLocation());a.x+=this.camNode.position.x,a.y+=this.camNode.position.y;var o=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(a);if(this.tiledMapManager.checkValidWalkablePos(o)){var s=this.getValidTiles(o);console.log("got tiles"+s.length),s.forEach(function(e){var i=e.node,n=t.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(t.tiledMapManager.tiledLayer.getPositionAt(o.x,o.y));t.selectedItem.setPosition(cc.v2(n.x+192,n.y+220)),i.addComponent(cc.Sprite),i.color=cc.Color.YELLOW,t.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){i.color=cc.Color.WHITE})))})}if(HandleClickEvent(e),this.selectedItem){var c=this.tiledMapManager.node.getComponent(cc.TiledMap),l=(c.getMapSize().height,c.getMapSize().width,e.getLocation());l.x+=this.camNode.position.x,l.y+=this.camNode.position.y;var r=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(l);if(this.tiledMapManager.checkValidPos(r)){this.tiledMapManager.checkValidWalkablePos(r)&&this.checkValidMovePos(r),onLoad(),this.node;var d=!1;try{var u=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("test",null,u)}catch(f){}d=!d||{capture:!0,passive:!0},"onwheel"in HTMLDivElement.prototype||document.onmousewheel,document.addEventListener("touchstart",handler,{capture:!0}),this.touchNode.on(cc.Node.EventType.TOUCH_START,this.HandleClickEvent,this),this.touchNode.on(cc.Node.EventType.MOUSE_DOWN,this.HandleClickEvent,this),this.touchNode.on("mousedown",function(){console.log("Hello!")}),this.touchNode.on(Node.EventType.MOUSE_DOWN,function(){console.log("Mouse down")},this),this.touchNode.on(cc.Node.EventType.MOUSE_MOVE,this.moveX,this,!0),this.touchNode.on(cc.Node.EventType.TOUCH_MOVE,this.moveX,this,!0),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),i.instance=this;var h=cc.director.getCollisionManager();cc.director.getPhysicsManager().enabled=!0,h.enabled=!0,this.createObjects(this.objectLayer),this.deltaY=0,moveY(y),this.deltaY=y.getScrollY(),this.camNode.setPosition(this.camNode.getPosition().x,this.camNode.getPosition().y+this.deltaY/10),moveX(x),this.HoverEvent(x),this.deltaX||(this.deltaX=x.getLocationX());var p=x.getLocationX()-this.deltaX;p+=1*Math.sign(p),this.camNode.setPosition(this.camNode.getPosition().x+p,this.camNode.getPosition().y),this.deltaX=x.getLocationX()}}}}),cc._RF.pop()},{"./TileMapManager":"TileMapManager"}],Item:[function(e,t){"use strict";cc._RF.push(t,"10650hz0j1ILq1vuQeq+SoT","Item"),cc.Class({extends:cc.Component,properties:{x:{type:cc.Integer,default:1},y:{type:cc.Integer,default:1}},onLoad:function(){console.log("loaded"+this.node.name)}}),cc._RF.pop()},{}],Screen:[function(e,t){"use strict";cc._RF.push(t,"1d0d23hJDxAjp/yoXwsx2e4","Screen"),cc.Class({extends:cc.Component,onLoad:function(){this.canvas=this.node.getComponent(cc.Canvas),Screen.canvasNode=this.node,this.resizeCanvas(),cc.view.resizeWithBrowserSize(!0),cc.view.setResizeCallback(this.resizeCanvas.bind(this))},resizeCanvas:function(){},statics:{canvasNode:0,getCanvasPosition:function(e){var t=e.parent.convertToWorldSpaceAR(e.getPosition());return Screen.canvasNode.convertToNodeSpaceAR(t)}}}),cc._RF.pop()},{}],TileMapManager:[function(e,t){"use strict";cc._RF.push(t,"c51dbwZNXVIFqsGLqr/uG7n","TileMapManager"),cc.Class({extends:cc.Component,properties:{canvasNode:{type:cc.Node,default:null},tiledMap:{type:cc.TiledMap,default:null},tiledLayer:{type:cc.TiledLayer,default:null},_invalidTiles:{default:[]}},onLoad:function(){this._mode="walk",this._invalidTiles=[]},getMappedTile:function(e){return this.tiledLayer.node.convertToNodeSpaceAR(e),e=this.GetMapPosition(this.tiledLayer,e),this.tiledLayer._isInvalidPosition(e.x,e.y)?null:this.tiledLayer.getTiledTileAt(e.x,e.y,!0)},checkValidPos:function(e){if(this.tiledLayer.node.convertToNodeSpaceAR(e),e=this.GetMapPosition(this.tiledLayer,e),this.tiledLayer._isInvalidPosition(e.x,e.y))return!1;var t=this.tiledLayer.getTiledTileAt(e.x,e.y,!0),i=this.tiledMap.getPropertiesForGID(t.gid);return!!i&&0!=i.isWalkable},checkValidWalkablePos:function(e){if(this.tiledLayer.node.convertToNodeSpaceAR(e),e=this.GetMapPosition(this.tiledLayer,e),this.tiledLayer._isInvalidPosition(e.x,e.y))return!1;var t=this.tiledLayer.getTiledTileAt(e.x,e.y,!0);if(t)for(var i=0;i<this._invalidTiles.length;i++)if(this._invalidTiles[i]==t)return!1;var n=this.tiledMap.getPropertiesForGID(t.gid);return!!n&&0!=n.isWalkable},GetMapPosition:function(e,t){var i=e.getMapTileSize().width,n=e.getMapTileSize().height,a=e.getLayerSize().width,o=e.getLayerSize().height,s=t.x/i,c=t.y/n,l=a/2,r=Math.floor(o-c+s-l),d=Math.floor(o-c-s+l);return new cc.Vec2(r,d)},MapIndexToNodePosition:function(e,t,i){return e.getPositionAt(t,i-1)},GetWalkableMatrixMapFromLayer:function(e,t,i){var n=e.getTileSets();console.log(n);var a=n,o=[];e.getProperties(),e.width=t,e.height=i;for(var s=0;s<t;s++){for(var c=[],l=0;l<i;l++){e._positionForIsoAt(s,l);var r=s*i+l;if(r<a.length){var d=this.tiledMap.getPropertiesForGID(a[r]);if(d)if(1==d.isWalkable){var u=this.MapIndexToNodePosition(e,s,l,this.node);if(this.getMappedTile(u)){for(var h=!1,p=0;p<this._invalidTiles.length;p++)if(this._invalidTiles[p].x==l&&this._invalidTiles[p].y==s){h=!0;break}h?c.push(1):c.push(0)}else c.push(0)}else c.push(1);else c.push(1)}}o.push(c)}return o},ResolveGridPathToPositions:function(e,t,i){if(null!=i){for(var n=[],a=null,o=null,s=1;s<t.length;s++){var c=t[s][0],l=t[s][1];if(a!=c&&o!=l){a=t[s-1][0],o=t[s-1][1];var r=this.MapIndexToNodePosition(e,a,o,i.node);n.push(r)}s==t.length-1&&(r=this.MapIndexToNodePosition(e,t[s][0],t[s][1],i.node),n.push(r))}return n}}}),cc._RF.pop()},{}]},{},["AudioManager","AudioModule","InputManager","Item","Screen","TileMapManager"]);